
--[[---------------------------------------------------------------------------------------------------------------------------------
 File			: observer.script
 Description	: Наблюдатели
 Copyright		: 2012 © boryan67
 Author			: boryan67(Dracula) & Aleksandr44 
 Last edit		: 07.09.2012 
--]]--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Таблицы координат по локациям
local tbl_promzone={
{
    position={x=-41.834503173828,y=21.306356430054,z=447.01867675781},
    lv=121520,
    gv=915
    },
{
    position={x=6.1909718513489,y=16.741548538208,z=411.36770629883},
    lv=205337,
    gv=964
    },
{
    position={x=44.226058959961,y=14.161916732788,z=386.96453857422},
    lv=286315,
    gv=1005
    },
{
    position={x=122.42376708984,y=9.4277858734131,z=338.71340942383},
    lv=429391,
    gv=1102
    },
{
    position={x=6.7407832145691,y=14.380014419556,z=197.16293334961},
    lv=206564,
    gv=959
    },
{
    position={x=-8.7670164108276,y=14.442770004272,z=144.89582824707},
    lv=172904,
    gv=895
    },
{
    position={x=25.50305557251,y=11.002914428711,z=142.43717956543},
    lv=245024,
    gv=1007
    },
{
    position={x=-87.600051879883,y=36.796577453613,z=89.540100097656},
    lv=51178,
    gv=860
    },
{
    position={x=42.245498657227,y=21.965299606323,z=36.66100692749},
    lv=281491,
    gv=1037
    },
{
    position={x=-17.257286071777,y=24.068019866943,z=24.733966827393},
    lv=158573,
    gv=901
    },
{
    position={x=-96.877326965332,y=39.069206237793,z=-71.593437194824},
    lv=38465,
    gv=854
    },
{
    position={x=-45.995040893555,y=29.032169342041,z=-91.241104125977},
    lv=114350,
    gv=904
    },
{
    position={x=68.328178405762,y=22.952962875366,z=-47.881950378418},
    lv=335939,
    gv=1042
    },
{
    position={x=49.459533691406,y=21.589418411255,z=6.5142250061035},
    lv=297799,
    gv=1024
    },
{
    position={x=52.785835266113,y=21.84553527832,z=-179.8664855957},
    lv=303599,
    gv=1014
    },
{
    position={x=29.774269104004,y=25.242107391357,z=-258.75994873047},
    lv=255302,
    gv=987
    },
{
    position={x=-29.710498809814,y=24.204650878906,z=-221.76168823242},
    lv=139663,
    gv=927
    },
{
    position={x=-97.789100646973,y=40.057792663574,z=-184.80068969727},
    lv=36516,
    gv=846
    },
{
    position={x=-27.138389587402,y=29.639806747437,z=-281.7262878418},
    lv=142811,
    gv=989
    },
{
    position={x=71.057525634766,y=28.257406234741,z=-340.56234741211},
    lv=340523,
    gv=1053
    },
{
    position={x=74.50968170166,y=29.224063873291,z=-367.28842163086},
    lv=345456,
    gv=1052
    },
{
    position={x=23.834144592285,y=21.56950378418,z=-525.76794433594},
    lv=241083,
    gv=979
    }
}
local tbl_dead_city={
{
    position={x=-144.13401794434,y=19.054975509644,z=-18.562892913818},
    lv=174119,
    gv=1225
    },
{
    position={x=-158.89186096191,y=19.054479598999,z=-0.36190292239189},
    lv=163451,
    gv=1362
    },
{
    position={x=-289.01312255859,y=9.1006965637207,z=-36.619651794434},
    lv=54273,
    gv=1185
    },
{
    position={x=-265.86206054688,y=9.5032901763916,z=-153.33247375488},
    lv=73203,
    gv=1199
    },
{
    position={x=-150.61013793945,y=3.5336482524872,z=-208.60308837891},
    lv=169620,
    gv=1241
    },
{
    position={x=54.856391906738,y=8.4172477722168,z=-189.09390258789},
    lv=337830,
    gv=1330
    },
{
    position={x=102.78651428223,y=8.0728120803833,z=-93.312805175781},
    lv=368227,
    gv=1355
    },
{
    position={x=103.7839050293,y=8.2761716842651,z=-25.532850265503},
    lv=368642,
    gv=1349
    },
{
    position={x=102.20232391357,y=5.8211250305176,z=71.316009521484},
    lv=368087,
    gv=1351
    },
{
    position={x=-207.40515136719,y=6.6462469100952,z=111.15855407715},
    lv=125119,
    gv=1213
    },
{
    position={x=-257.20288085938,y=4.9604530334473,z=73.881484985352},
    lv=81530,
    gv=1194
    },
{
    position={x=-85.453086853027,y=13.686363220215,z=-49.39253616333},
    lv=224994,
    gv=1269
    },
{
    position={x=-110.06433105469,y=13.701110839844,z=-49.533676147461},
    lv=200761,
    gv=1269
    },
{
    position={x=-103.67852783203,y=13.700115203857,z=-62.575794219971},
    lv=207102,
    gv=1269
    },
{
    position={x=-80.504829406738,y=16.326856613159,z=34.009967803955},
    lv=229529,
    gv=1242
    },
{
    position={x=-113.46134185791,y=16.32608795166,z=63.358337402344},
    lv=197755,
    gv=1242
    },
{
    position={x=-83.591697692871,y=16.325553894043,z=63.965309143066},
    lv=227058,
    gv=1242
    },
{
    position={x=-50.459465026855,y=4.2684993743896,z=49.408321380615},
    lv=256413,
    gv=1285
    },
{
    position={x=-42.544277191162,y=9.2439918518066,z=-16.377792358398},
    lv=262623,
    gv=1272
    }
}
local tbl_dyshlo={
-- dyshlo
{
    position={x=-250.26504516602,y=14.057695388794,z=-272.07504272461},
    lv=21336,
    gv=0
    },
{
    position={x=-144.96585083008,y=14.932641983032,z=-266.41302490234},
    lv=134378,
    gv=0
    },
{
    position={x=-98.128303527832,y=27.92699432373,z=-191.76916503906},
    lv=185315,
    gv=0
    },
{
    position={x=-113.57498168945,y=28.186393737793,z=-85.118644714355},
    lv=168763,
    gv=0
    },
{
    position={x=-262.71752929688,y=21.625961303711,z=6.4004220962524},
    lv=10184,
    gv=0
    },
{
    position={x=-77.79663848877,y=27.675802230835,z=-25.400163650513},
    lv=207893,
    gv=0
    },
{
    position={x=-48.259220123291,y=23.659690856934,z=70.21834564209},
    lv=239611,
    gv=1
    },
{
    position={x=-28.786169052124,y=21.636722564697,z=178.11175537109},
    lv=260942,
    gv=1
    },
{
    position={x=70.580513000488,y=22.747894287109,z=238.50622558594},
    lv=368296,
    gv=1
    },
{
    position={x=124.30288696289,y=23.16096496582,z=146.14074707031},
    lv=426594,
    gv=1
    },
{
    position={x=238.74208068848,y=22.916185379028,z=229.07257080078},
    lv=550523,
    gv=1
    },
{
    position={x=220.97691345215,y=29.744876861572,z=89.126251220703},
    lv=531892,
    gv=1
    },
{
    position={x=61.109172821045,y=28.545921325684,z=-9.8012609481812},
    lv=357131,
    gv=0
    },
{
    position={x=186.04447937012,y=30.917924880981,z=-92.715476989746},
    lv=493318,
    gv=0
    },
{
    position={x=212.24487304688,y=29.554496765137,z=-138.32931518555},
    lv=521695,
    gv=0
    },
{
    position={x=182.58869934082,y=28.688594818115,z=-206.99757385254},
    lv=489327,
    gv=0
    },
{
    position={x=71.642044067383,y=34.230792999268,z=-191.03396606445},
    lv=368472,
    gv=0
    },
{
    position={x=1.8373217582703,y=30.253444671631,z=-226.50140380859},
    lv=294418,
    gv=0
    }
}
local tbl_predbannik={
{
    position={x=-372.47064208984,y=16.093647003174,z=-322.95004272461},
    lv=369185,
    gv=661
    },
{
    position={x=-170.6194152832,y=23.479988098145,z=-252.95889282227},
    lv=676356,
    gv=703
    },
{
    position={x=11.047387123108,y=21.333469390869,z=-167.47999572754},
    lv=960288,
    gv=735
    },
{
    position={x=26.667449951172,y=11.149280548096,z=-360.36831665039},
    lv=984236,
    gv=758
    },
{
    position={x=130.73197937012,y=21.563940048218,z=-13.822590827942},
    lv=1149339,
    gv=768
    },
{
    position={x=42.170497894287,y=21.035949707031,z=99.791839599609},
    lv=1009139,
    gv=751
    },
{
    position={x=102.73458862305,y=28.914093017578,z=284.4619140625},
    lv=1105481,
    gv=766
    },
{
    position={x=-82.763359069824,y=26.571670532227,z=253.3250579834},
    lv=816316,
    gv=766
    },
{
    position={x=-235.13356018066,y=39.451145172119,z=273.49014282227},
    lv=578675,
    gv=766
    },
{
    position={x=-279.10794067383,y=40.405269622803,z=223.83409118652},
    lv=509509,
    gv=766
    },
{
    position={x=-279.00259399414,y=40.47233581543,z=257.39971923828},
    lv=509579,
    gv=766
    },
{
    position={x=22.943353652954,y=14.721737861633,z=466.84698486328},
    lv=979737,
    gv=753
    },
{
    position={x=-193.85391235352,y=12.755802154541,z=453.62548828125},
    lv=641166,
    gv=704
    },
{
    position={x=-382.60711669922,y=25.579193115234,z=448.75112915039},
    lv=354741,
    gv=653
    },
{
    position={x=-486.98361206055,y=36.531944274902,z=207.25959777832},
    lv=198699,
    gv=636
    },
{
    position={x=-597.70947265625,y=34.393459320068,z=137.14498901367},
    lv=35374,
    gv=621
    },
{
    position={x=-501.15203857422,y=23.181871414185,z=-40.300540924072},
    lv=176282,
    gv=639
    }
}
local tbl_bar={
{
    position={x=199.40783691406,y=6.6575660705566,z=-151.892578125},
    lv=47432,
    gv=282
    },
{
    position={x=430.84194946289,y=14.18922996521,z=-413.71374511719},
    lv=99516,
    gv=290
    },
{
    position={x=378.22210693359,y=13.169164657593,z=-146.79238891602},
    lv=83840,
    gv=286
    },
{
    position={x=277.31787109375,y=-0.007990837097168,z=-64.487586975098},
    lv=68875,
    gv=275
    },
{
    position={x=34.194702148438,y=-3.3758692741394,z=308.40420532227},
    lv=20667,
    gv=247
    }
}
local tbl_aver={
{
    position={x=-152.57647705078,y=9.5745429992676,z=357.11407470703},
    lv=608000,
    gv=784
    },
{
    position={x=-360.34481811523,y=-13.581789016724,z=207.82443237305},
    lv=249148,
    gv=779
    },
{
    position={x=-348.36672973633,y=-14.881083488464,z=205.97396850586},
    lv=270326,
    gv=779
    },
{
    position={x=324.74755859375,y=39.583011627197,z=-212.80715942383},
    lv=1446148,
    gv=791
    },
{
    position={x=424.4807434082,y=28.991868972778,z=-72.084716796875},
    lv=1637626,
    gv=795
    },
{
    position={x=190.14305114746,y=26.203964233398,z=-143.09442138672},
    lv=1201977,
    gv=790
    },
{
    position={x=51.478122711182,y=24.695402145386,z=-317.28564453125},
    lv=957952,
    gv=788
    },
{
    position={x=-206.45835876465,y=28.333070755005,z=-338.7438659668},
    lv=515100,
    gv=780
    },
{
    position={x=-312.27935791016,y=15.65002822876,z=-224.2414855957},
    lv=333936,
    gv=780
    },
{
    position={x=-170.76921081543,y=13.746576309204,z=-101.0546875},
    lv=575855,
    gv=782
    },
{
    position={x=-147.29504394531,y=6.9393744468689,z=-122.75329589844},
    lv=617016,
    gv=782
    },
{
    position={x=-94.228759765625,y=18.140573501587,z=-73.35961151123},
    lv=708075,
    gv=782
    },
{
    position={x=-79.784393310547,y=8.9969730377197,z=-32.202697753906},
    lv=733284,
    gv=782
    },
{
    position={x=-270.6344909668,y=10.034007072449,z=-3.0921156406403},
    lv=406080,
    gv=777
    },
{
    position={x=-370.94952392578,y=20.896596908569,z=70.918182373047},
    lv=230686,
    gv=777
    },
{
    position={x=-316.19647216797,y=14.018584251404,z=78.142501831055},
    lv=326617,
    gv=781
    },
{
    position={x=-283.09103393555,y=-7.6338262557983,z=154.99443054199},
    lv=385270,
    gv=779
    },
{
    position={x=-284.70233154297,y=-18.662063598633,z=273.76721191406},
    lv=381695,
    gv=779
    },
{
    position={x=-167.48837280273,y=6.5269122123718,z=212.30233764648},
    lv=582136,
    gv=783
    },
{
    position={x=-124.61851501465,y=5.2660474777222,z=250.62631225586},
    lv=656252,
    gv=783
    },
{
    position={x=-7.0723986625671,y=-10.989830970764,z=212.16314697266},
    lv=855006,
    gv=783
    },
{
    position={x=254.5910949707,y=-9.4940309524536,z=251.96759033203},
    lv=1319560,
    gv=794
    },
{
    position={x=187.61526489258,y=29.316173553467,z=98.169746398926},
    lv=1197306,
    gv=789
    },
{
    position={x=71.648086547852,y=11.686903953552,z=361.47277832031},
    lv=994016,
    gv=787
    },
{
    position={x=-98.681976318359,y=8.5147933959961,z=363.31851196289},
    lv=701179,
    gv=784
    }
}
local tbl_swamp={
{
    position={x=283.84591674805,y=4.8814353942871,z=-271.34823608398},
    lv=1763948,
    gv=798
    },
{
    position={x=286.96994018555,y=7.5021710395813,z=-175.00672912598},
    lv=1771671,
    gv=798
    },
{
    position={x=116.90539550781,y=2.8621230125427,z=-77.241523742676},
    lv=1402444,
    gv=799
    },
{
    position={x=42.807518005371,y=5.1169261932373,z=-125.95695495605},
    lv=1238825,
    gv=798
    },
{
    position={x=-91.64208984375,y=4.5023808479309,z=-199.55302429199},
    lv=945482,
    gv=798
    },
{
    position={x=-130.03407287598,y=6.5022897720337,z=-98.826568603516},
    lv=863933,
    gv=797
    },
{
    position={x=-140.53639221191,y=21.533634185791,z=51.891986846924},
    lv=843164,
    gv=799
    },
{
    position={x=-228.27493286133,y=12.002283096313,z=93.111503601074},
    lv=657233,
    gv=799
    },
{
    position={x=-145.52445983887,y=5.9367551803589,z=180.13519287109},
    lv=833399,
    gv=797
    },
{
    position={x=10.679489135742,y=1.8221544027328,z=156.25186157227},
    lv=1168576,
    gv=799
    },
{
    position={x=92.754425048828,y=19.256631851196,z=58.71427154541},
    lv=1350324,
    gv=799
    },
{
    position={x=166.66342163086,y=2.2954654693604,z=160.60467529297},
    lv=1510988,
    gv=799
    },
{
    position={x=245.33824157715,y=8.7696189880371,z=305.35754394531},
    lv=1681299,
    gv=799
    },
{
    position={x=31.603017807007,y=4.8628978729248,z=300.62655639648},
    lv=1214707,
    gv=799
    },
{
    position={x=265.04238891602,y=19.413669586182,z=81.133773803711},
    lv=1724970,
    gv=799
    }
}
local tbl_hiding_road={
{
    position={x=389.98022460938,y=8.1966867446899,z=95.029670715332},
    lv=1030357,
    gv=1698
    },
{
    position={x=284.05517578125,y=4.7523174285889,z=127.0192489624},
    lv=918373,
    gv=1677
    },
{
    position={x=225.69079589844,y=4.9775214195251,z=238.84875488281},
    lv=828600,
    gv=1663
    },
{
    position={x=172.56457519531,y=8.7383041381836,z=317.35299682617},
    lv=748972,
    gv=1646
    },
{
    position={x=-8.2526407241821,y=7.1412200927734,z=475.77331542969},
    lv=449597,
    gv=1590
    },
{
    position={x=-154.2186126709,y=7.7852478027344,z=422.02822875977},
    lv=222441,
    gv=1544
    },
{
    position={x=-220.06781005859,y=8.1804141998291,z=132.1721496582},
    lv=123286,
    gv=1525
    },
{
    position={x=-98.853973388672,y=4.3399715423584,z=166.1220703125},
    lv=308894,
    gv=1557
    },
{
    position={x=70.294990539551,y=6.4374933242798,z=157.35302734375},
    lv=580377,
    gv=1605
    },
{
    position={x=-63.132614135742,y=-1.4856196641922,z=71.225074768066},
    lv=364151,
    gv=1556
    },
{
    position={x=-233.36473083496,y=1.2707139253616,z=20.098709106445},
    lv=104953,
    gv=1526
    },
{
    position={x=-128.27421569824,y=6.4388003349304,z=-172.4347076416},
    lv=262161,
    gv=1548
    },
{
    position={x=-34.629371643066,y=10.643960952759,z=-312.87356567383},
    lv=407431,
    gv=1582
    },
{
    position={x=86.16918182373,y=2.9140937328339,z=-133.7770690918},
    lv=606917,
    gv=1609
    },
{
    position={x=181.10729980469,y=8.4279289245605,z=-110.4089050293},
    lv=761000,
    gv=1647
    },
{
    position={x=273.6125793457,y=11.317406654358,z=-258.88763427734},
    lv=901345,
    gv=1660
    },
{
    position={x=330.71765136719,y=6.2051167488098,z=-92.119667053223},
    lv=976879,
    gv=1688
    },
{
    position={x=145.20468139648,y=4.9160075187683,z=-7.2555031776428},
    lv=703942,
    gv=1626
    },
{
    position={x=47.527515411377,y=-1.0301002264023,z=-1.6603497266769},
    lv=542203,
    gv=1601
    }
}
local tbl_pripyat={
{
    position={x=-13.551204681396,y=15.547501564026,z=-156.31497192383},
    lv=85886,
    gv=458
    },
{
    position={x=-13.323257446289,y=15.563802719116,z=-99.466339111328},
    lv=85918,
    gv=463
    },
{
    position={x=188.50231933594,y=28.663299560547,z=107.00943756104},
    lv=258961,
    gv=560
    },
{
    position={x=124.7872543335,y=17.634990692139,z=114.28829956055},
    lv=230731,
    gv=512
    },
{
    position={x=98.531433105469,y=24.251552581787,z=123.02811431885},
    lv=209487,
    gv=607
    },
{
    position={x=70.363456726074,y=7.3207631111145,z=202.1184387207},
    lv=182354,
    gv=466
    },
{
    position={x=59.637454986572,y=7.3222818374634,z=213.63674926758},
    lv=171624,
    gv=466
    },
{
    position={x=-53.500637054443,y=15.426055908203,z=127.32675933838},
    lv=46956,
    gv=465
    },
{
    position={x=-110.83659362793,y=28.648834228516,z=112.86999511719},
    lv=11230,
    gv=550
    },
{
    position={x=-110.83878326416,y=28.663818359375,z=89.311218261719},
    lv=11172,
    gv=550
    },
{
    position={x=-110.8616104126,y=28.455688476563,z=144.02932739258},
    lv=11266,
    gv=491
    },
{
    position={x=-111.16111755371,y=28.467399597168,z=167.00714111328},
    lv=10841,
    gv=491
    },
{
    position={x=-110.33673858643,y=28.663679122925,z=197.38385009766},
    lv=11359,
    gv=557
    },
{
    position={x=-110.89264678955,y=28.663677215576,z=221.39262390137},
    lv=11417,
    gv=557
    },
{
    position={x=-112.8787612915,y=20.648601531982,z=267.0856628418},
    lv=9896,
    gv=490
    },
{
    position={x=147.12275695801,y=20.646427154541,z=271.72384643555},
    lv=243601,
    gv=488
    },
{
    position={x=190.1572265625,y=20.648807525635,z=247.99772644043},
    lv=260058,
    gv=488
    },
{
    position={x=188.66694641113,y=28.664278030396,z=218.8053894043},
    lv=259464,
    gv=558
    },
{
    position={x=188.84124755859,y=28.663690567017,z=195.79881286621},
    lv=259383,
    gv=558
    }
}
-------------------------------------------------------------------------------
local observerID	-- ИД НАБЛЮДАТЕЛЯ
-------------------------------------------------------------------------------
function get_obj()
	local lev_name = level.name()
	local tbl = nil
	-- выбираем таблицу в зависимости от уровня
	if lev_name=="promzone" then tbl = tbl_promzone
	elseif lev_name=="dead_city" then tbl = tbl_dead_city
	elseif lev_name=="dyshlo" then tbl = tbl_dyshlo
	elseif lev_name=="predbannik" then tbl = tbl_predbannik
	elseif lev_name=="l05_bar" then tbl = tbl_bar
	elseif lev_name=="aver" then tbl = tbl_aver
	elseif lev_name=="swamp" then tbl = tbl_swamp
	elseif lev_name=="hiding_road" then tbl = tbl_hiding_road
	elseif lev_name=="l11_pripyat" then tbl = tbl_pripyat
	else return	-- подземка, ничего не создаем
	end
	-- ищем ближайшую к актору оффлайновую точку спавна наблюдателя
	local actor = db.actor
	if not actor then return end
	local actor_pos = actor:position()
	if actor_pos then
		local dist = 0
		local min_dist = 10000
		local temp
		local pos=vector()
		local num_pos = nil
		for i=1, table.getn(tbl) do
			temp = tbl[i]
			pos=vector():set(temp.position.x,temp.position.y,temp.position.z)
			dist = actor_pos:distance_to(pos)
			if dist < min_dist and dist > 150 then
				min_dist = dist	-- запомнили расстояние
				num_pos = i		-- запомнили позицию в таблице
			end
		end
		-- если поиск позиции прошел удачно, то спавним наблюдателя
		if num_pos then
			local sim = alife()
			temp = tbl[num_pos]
			local sobj = sim:create("observer_set", vector():set(temp.position.x,temp.position.y,temp.position.z), temp.lv, temp.gv)
			if sobj then
				obj = level.object_by_id(sobj.id)	-- получаем клиентский объект
				if obj then
					obj:set_relation(game_object.neutral, db.actor)	-- сбрасываем враждебность на всякий случай
				end
				observerID = sobj.id	-- запоминаем ID
				amk.save_variable("observer",observerID)
			end
		end
	end
end
-------------------------------------------------------------------------------

function del_obj()
	observerID = amk.load_variable("observer",0)
	if observerID==0 then return end
	local sim = alife()
	local obj
	local sobj = sim:object(observerID)	-- получаем серверный объект
	if sobj then obj = level.object_by_id(sobj.id) end	-- получаем клиентский объект
	if obj then
		-- играем партикл в позиции объекта если он в онлайне
		amk_particle.amk_particle({particle="anomaly2\\teleport_idle", pos=obj:position(), sound="anomaly\\teleport_idle"})
	end
	if sobj then	-- объект существует
		sim:release(sobj,true)-- удаляем серверный объект
		observerID = 0	-- чистим ID
		amk.save_variable("observer",observerID)
	end
end
-------------------------------------------------------------------------------

function on_start()
	observerID = amk.load_variable("observer",0)
	local sobj, obj
	local sim = alife()
	if observerID>0 then		-- ID существует
		sobj = sim:object(observerID)	-- получаем серверный объект
		if sobj then 
			obj = level.object_by_id(sobj.id) -- получаем клиентский объект
			if obj then
				return -- объект в онлайне, не трогаем
			else	-- объект в оффлайне, нужно его пересоздать
				del_obj()	-- удаляем наблюдателя
				if observerID==0 then get_obj() end	-- создаем наблюдателя
			end
		else		-- нештатная ситуация! ИД есть, а объекта нет! 
			observerID=0	-- обнуляем ИД
			amk.save_variable("observer",observerID)
		end		
	else	-- объекта нет, нужно его создать
		get_obj()	-- создаем наблюдателя
	end
        if has_alife_info('nablyudatel_spynet') then sar_respawn() end -- спавн Наблюдателей в Саркофаге
end
-------------------------------------------------------------------------------

-- респавн Наблюдателей в Саркофаге
-- таблица координат Наблюдателей
local tbl_sar = {
 [1] = {'nablyudatel_01', vector():set(8.844,49.035,8.748),3417,1378},
 [2] = {'nablyudatel_02', vector():set(7.822,52.244,21.255),3268,1378},
 [3] = {'nablyudatel_03', vector():set(33.790,47.143,9.555),6561,1378},
 [4] = {'nablyudatel_04', vector():set(43.373,53.577,18.911),7727,1378},
 [5] = {'nablyudatel_05', vector():set(24.835,50.938,24.778),5460,1378}
}
function sar_respawn()
 local id, sobj, rec
 local sim = alife()
 for n=1, 5 do
  -- для начала почистим всех существующих Наблюдателей
  id = amk.load_variable("sar_observer"..tostring( n), 0)
  if id>0 then
   sobj = sim:object(id)
   amk.del_variable("sar_observer"..tostring( n))
   if sobj then
    sim:release(sobj,true)
   end
  end
  -- заспавним снова
  rec = tbl_sar[n]
  if not has_alife_info(rec[1]..'_dead') then -- если нет информации о его смерти
   sobj = sim:create(rec[1], rec[2], rec[3], rec[4]) -- пересоздадим
   if sobj then
    amk.save_variable("sar_observer"..tostring( n), sobj.id) -- запомним ид
   end
  end
 end
end


